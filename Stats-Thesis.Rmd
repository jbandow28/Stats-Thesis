---
title: "Thesis code"
author: "Jackson Bandow"
date: "2/5/2021"
output: html_document
---

Libraries necessary for project

```{r}
library(Lahman)
library(rvest)
library(dplyr)
library(readr)
library(httr)
library(data.table)
library(ggplot2)
library(plotly)
```


Import dataset

```{r, include=FALSE}
data("Master")
data("Batting")
data("Pitching")
data("HallOfFame")
```

Compile seasonal stats to career dataset

```{r, include=FALSE}
sum_vec <- function(vec) {
  data <- na.omit(vec)
  if (length(data) == 0) return(NA)
  else return(sum(data))
}

replace_na <- function(vec, rep) {
  res <- vec
  for (i in 1:length(vec)) {
    if (is.na(res[i])) res[i] <- rep
  }
  return(res)
}

# Batting
emp <- rep(NA, length(unique(Batting$playerID)))

batting_career <- data.frame(playerID = unique(Batting$playerID), firstyearID.B = emp, lastyearID.B = emp, G.B = emp, AB = emp, R = emp, H.B = emp, X2B = emp, X3B = emp, HR.B = emp, RBI = emp, SB = emp, CS = emp, BB.B = emp, SO.B = emp, IBB.B = emp, HBP.B = emp, SH.B = emp, SF.B = emp, GIDP.B = emp)

for (i in batting_career$playerID) {
  seasonal <- Batting[Batting$playerID == i,]
  batting_career[batting_career$playerID == i,-1] <- c(min(seasonal$yearID), max(seasonal$yearID), sum_vec(seasonal$G), sum_vec(seasonal$AB), sum_vec(seasonal$R), sum_vec(seasonal$H), sum_vec(seasonal$X2B), sum_vec(seasonal$X3B), sum_vec(seasonal$HR), sum_vec(seasonal$RBI), sum_vec(seasonal$SB), sum_vec(seasonal$CS), sum_vec(seasonal$BB), sum_vec(seasonal$SO), sum_vec(seasonal$IBB), sum_vec(seasonal$HBP), sum_vec(seasonal$SH), sum_vec(seasonal$SF), sum_vec(seasonal$GIDP))
}

# Pitching
emp <- rep(NA, length(unique(Pitching$playerID)))

pitching_career <- data.frame(playerID = unique(Pitching$playerID), firstyearID.P = emp, lastyearID.P = emp, W = emp, L = emp, G.P = emp, GS = emp, CG = emp, SHO = emp, SV = emp, IPout = emp, H.P = emp, ER = emp, HR.P = emp, BB.P = emp, SO.P = emp, BAOpp = emp, ERA = emp, IBB.P = emp, WP = emp, HBP.P = emp, BK = emp, BFP = emp, GF = emp, R = emp, SH.P = emp, SF.P = emp, GIDP.P = emp)

for (i in pitching_career$playerID) {
  seasonal <- Pitching[Pitching$playerID == i,]
  pitching_career[pitching_career$playerID == i,-1] <- c(min(seasonal$yearID), max(seasonal$yearID), sum_vec(seasonal$W), sum_vec(seasonal$L), sum_vec(seasonal$G), sum_vec(seasonal$GS), sum_vec(seasonal$CG), sum_vec(seasonal$SHO), sum_vec(seasonal$SV), sum_vec(seasonal$IPout), sum_vec(seasonal$H), sum_vec(seasonal$ER), sum_vec(seasonal$HR), sum_vec(seasonal$BB), sum_vec(seasonal$SO), sum(seasonal$BFP * seasonal$BAOpp) / sum_vec(seasonal$BFP), sum(seasonal$IPout * seasonal$ERA) / sum_vec(seasonal$IPout), sum_vec(seasonal$IBB), sum_vec(seasonal$WP), sum_vec(seasonal$HBP), sum_vec(seasonal$BK), sum_vec(seasonal$BFP), sum_vec(seasonal$GF), sum_vec(seasonal$R), sum_vec(seasonal$SH), sum_vec(seasonal$SF), sum_vec(seasonal$GIDP))
}
```


Attaching WAR

```{r, include=FALSE}
# Find duplicate indices of df sorted by given col
find_dup_indices <- function(col) {
  data <- sort(col) 
  res <- NULL
  for (i in 1:length(data)) {
    if (data[i] == data[((i-2) %% length(data)) + 1] | data[i] == data[(i %% length(data)) + 1]) {
      res <- append(res, i)
    }
  }
  return(res)
}


# FanGraphs WAR

fan_pitch <- read.csv("FanGraphs Leaderboard (1)pitching.csv")[,c("playerid", "WAR")]
colnames(fan_pitch) <- c("fangraphsID", "fWAR_pitch")
fan_bat <- read.csv("FanGraphs Leaderboard (1).csv")[,c("playerid", "WAR")]
colnames(fan_bat) <- c("fangraphsID", "fWAR_bat")


fangraphs <- data.frame()
#fangraphs <- fangraphs[1:764,]
working <- TRUE
while(working) {
  print(i)
  stat <- status_code(GET(paste0("http://www.fangraphs.com/statss.aspx?playerid=", i)))
  if (stat != 500) {
    page <- read_html(paste0("http://www.fangraphs.com/statss.aspx?playerid=", i))
    name <- page %>% html_nodes("h1") %>% html_text()
    bday <- page %>% html_nodes(".player-info__bio-birthdate td") %>% html_text()
    if (length(name) == 0) working <- FALSE
    else fangraphs <- rbind(fangraphs, c(i, name, bday)) 
  }
  i <- i + 1
}
colnames(fangraphs) <- c("fangraphsID", "Name", "DOB")

fangraphs$birthMonth <- as.integer(gsub("/.*$?", "", fangraphs$DOB))
fangraphs$birthDay <- as.integer(gsub("/.*$?", "", gsub("^[0-9]*/?", "", fangraphs$DOB)))
fangraphs$birthYear <- as.integer(substr(gsub("^[0-9]*/?", "", gsub("^[0-9]*/?", "", fangraphs$DOB)), 1, 4))
fangraphs$birthDate <- as.Date(paste(fangraphs$birthYear, fangraphs$birthMonth, fangraphs$birthDay, sep = "-"))
fangraphs$Name <- trimws(fangraphs$Name)
fangraphs$fangraphsID <- as.integer(fangraphs$fangraphsID)
fangraphs <- fangraphs %>% dplyr::select(c("fangraphsID", "Name", "birthDate"))
fwrite(fangraphs, "fangraphsID.csv")

fangraphs <- fread("fangraphsID.csv")

Master$Name <- paste(Master$nameFirst, Master$nameLast, sep = " ")
Master2 <- Master
Master2 <- left_join(Master2, fangraphs, by = c("Name", "birthDate"))
Master2 <- Master2[order(Master2$fangraphsID),]
Master2[16945,]$fangraphsID <- NA
Master2 <- Master2[-c(15581, 15582, 15641, 15642, 16258, 16259),]
Master2 <- Master2[order(Master2$playerID),]
Master2 <- Master2[-c(12498, 12755),]

leftover_fangraphs <- fangraphs[!(fangraphs$fangraphsID %in% Master2$fangraphsID),]
leftover_Master2 <- Master2[is.na(Master2$fangraphsID),]

leftover_fangraphs$Name <- gsub("~", "", gsub("'", "", iconv(gsub("Jr.", "", gsub("[^[:alnum:] [:punct:]]", "", leftover_fangraphs$Name)), from = "UTF-8", to = "ASCII//TRANSLIT")))
leftover_Master2$Name <- gsub("'", "", leftover_Master2$Name)
# leftover_fangraphs$nameFirst <- gsub(" .*$", "", leftover_fangraphs$Name)
# leftover_fangraphs$nameLast <- gsub(" .*$", "", gsub("^\\S* ", "", leftover_fangraphs$Name))
leftover_Master2_t <- left_join(leftover_Master2, leftover_fangraphs, by = c("Name", "birthDate"))
leftover_Master2_t$fangraphsID <- leftover_Master2_t$fangraphsID.y

dictionary <- Master2 %>% dplyr::select(playerID, bbrefID, fangraphsID)
dictionary <- dictionary[!is.na(dictionary$fangraphsID),]
dictionary <- rbind(dictionary, leftover_Master2_t[!is.na(leftover_Master2_t$fangraphsID), c("playerID", "bbrefID", "fangraphsID")])
fwrite(dictionary, "dictionary.csv")

leftover_fangraphs <- leftover_fangraphs[!(leftover_fangraphs$fangraphsID %in% leftover_Master2_t$fangraphsID),]
leftover_Master2 <- leftover_Master2_t[is.na(leftover_Master2_t$fangraphsID),]

leftover_fangraphs$Name <- gsub(" ", "", leftover_fangraphs$Name)
leftover_Master2$Name <- gsub(" ", "", leftover_Master2$Name)
leftover_Master2_t <- left_join(leftover_Master2, leftover_fangraphs, by = c("Name", "birthDate"))
leftover_Master2_t$fangraphsID <- leftover_Master2_t$fangraphsID.y.y
dictionary <- rbind(dictionary, leftover_Master2_t[!is.na(leftover_Master2_t$fangraphsID), c("playerID", "bbrefID", "fangraphsID")])
fwrite(dictionary, "dictionary.csv")

leftover_fangraphs <- leftover_fangraphs[!(leftover_fangraphs$fangraphsID %in% leftover_Master2_t$fangraphsID),]
leftover_Master2 <- leftover_Master2[!(leftover_Master2$playerID %in% dictionary$playerID),]

leftover_Master2$Name <- gsub("[[:punct:]]", "", leftover_Master2$Name)
leftover_Master2_t <- leftover_Master2_t[order(leftover_Master2_t$Name), ]
leftover_Master2_t[1,"fangraphsID.y"] <- 1006417
leftover_Master2_t[2,"fangraphsID.y"] <- 1420
leftover_Master2_t[3,"fangraphsID.y"] <- 531

leftover_Master2_t <- left_join(leftover_Master2, leftover_fangraphs, by = c("birthDate"))

temp_adds <- leftover_Master2_t[!is.na(leftover_Master2_t$fangraphsID.y),]
fwrite(temp_adds, "temp_odds.csv")
temp_adds <- temp_adds[-c(1,3,16:260,262:947,949:1414,1418:1883, 1886, 1888:2120, 2124:2144, 2146:2356,2360:2826,2829:3294, 3296:3331, 3333:3528,3533:3766,3768:3805,3807:4000,4003:4043,4045:4235,4237:4278,4280:4469,4471,4475,4478,4484,4521:4753,4757:4811,4813:4989,4991:5223, 5231:5463,5472:5704,5707:5781,5783:5941,5944:6409,6411:6725,6727:7110,7114:7346,7355:7587,7592:7682,7684:8057,8059,8061:8293,8297:8995, 8997:9462,9465:9697,9704:9804,9806:9936,9938,9940:10405,10407:10639,10641,10643:11108,11123,11140:11838,11841:12192,12194:12306,12310:12542, 12546:12668,12670:12778,12784:12913,12915:13016,13021:14095,14097:14419,14424:14657,14660:14815,14817:14892,14895:15127,15136, 15139:15371,15374:15606,15608:15840,15848:16015,16017:16081,16083,16086:16784,16787,16791:16964,16966:17023,17029:17261,17275:17507, 17513:17745,17748:18213,18216:18448,18450:18639,18641:18682,18685:19383,19388:19620,19623:19855,19858,19862:20094,20096:20761, 20763:20794,20797:20999,21001:21702,21704:21961,21963,21966:22176,22178:22198,22201,22204:22436,22438,22440:22672,22691:22907, 22909:22923,22926,22936:23154,23156:23168,23174:23395,23397:23406,23408,23411,23413,23417:23882,23884:24116,24119:24351),]
temp_adds$fangraphsID <- temp_adds$fangraphsID.y
dictionary <- rbind(dictionary, temp_adds[,c("playerID", "bbrefID", "fangraphsID")])
fwrite(dictionary, "dictionary.csv")


leftover_Master2 <- leftover_Master2[!(leftover_Master2$playerID %in% dictionary$playerID),]
leftover_fangraphs <- leftover_fangraphs[!(leftover_fangraphs$fangraphsID %in% dictionary$fangraphsID),]



Master2 <- left_join(Master2, fan_pitch, by = "fangraphsID")
Master2 <- left_join(Master2, fan_bat, by = "fangraphsID")
Master2$fWAR <- ifelse(is.na(Master2$fWAR_bat) & is.na(Master2$fWAR_pitch), NA, ifelse(is.na(Master2$fWAR_bat), 0, Master2$fWAR_bat) + ifelse(is.na(Master2$fWAR_pitch), 0, Master2$fWAR_pitch))



# Baseball Reference WAR

rWAR <- data.frame(playerID = Master$playerID, bbrefID = Master$bbrefID, finalGame = Master$finalGame, rWAR = NA, rWAR_batting = NA, rWAR_pitching = NA)
rWAR[7443,"bbrefID"] <- "harribe01"
rWAR <- rWAR[-5905,]

get_rWAR <- function(row) {
  if (!is.na(row["bbrefID"]) & !is.na(row["finalGame"])) {
    page <- read_html(paste0("https://www.baseball-reference.com/players/", substr(row["bbrefID"], 1, 1), "/", row["bbrefID"], ".shtml"))
    total <- page %>% html_nodes(".p1 div:nth-child(1) p+ p") %>% html_text() %>% as.numeric()
    if (length(total) == 0) total <- page %>% html_nodes(".p1 div:nth-child(1) p") %>% html_text() %>% as.numeric()
    new_page <- page %>% html_nodes(xpath = '//comment()') %>% html_text() %>% paste(collapse = '') %>% read_html()
    batting <- new_page %>% html_nodes("#batting_value tfoot tr:nth-child(1) .right:nth-child(14)") %>% html_text() %>% as.numeric()
    if (length(batting) == 0) batting <- NA
    pitching <- new_page %>% html_nodes("#pitching_value tfoot tr:nth-child(1) .right:nth-child(17)") %>% html_text() %>% as.numeric()
    if (length(pitching) == 0) pitching <- NA
    return(c(total, batting, pitching))
  }
  return(NA)
}

get_rWAR2 <- function(row) {
  page <- read_html(paste0("https://www.baseball-reference.com/players/", substr(row["bbrefID"], 1, 1), "/", row["bbrefID"], ".shtml"))
  total <- page %>% html_nodes(".p1 div:nth-child(1) p+ p") %>% html_text() %>% as.numeric()
  if (length(total) == 0) total <- page %>% html_nodes(".p1 div:nth-child(1) p") %>% html_text() %>% as.numeric()
  new_page <- page %>% html_nodes(xpath = '//comment()') %>% html_text() %>% paste(collapse = '') %>% read_html()
  batting <- new_page %>% html_nodes("#batting_value tfoot tr:nth-child(1) .right:nth-child(14)") %>% html_text() %>% as.numeric()
  if (length(batting) == 0) batting <- NA
  pitching <- new_page %>% html_nodes("#pitching_value tfoot tr:nth-child(1) .right:nth-child(17)") %>% html_text() %>% as.numeric()
  if (length(pitching) == 0) pitching <- NA
  else {
    pitching2 <- new_page %>% html_nodes("#pitching_value tfoot tr:nth-child(1) .right:nth-child(18)") %>% html_text() %>% as.numeric()
    pitch_approx <- total - ifelse(is.na(batting),0,batting)
    if (abs(pitch_approx - pitching) > abs(pitch_approx - pitching2)) {
      pitching <- pitching2
    }
  }
  return(c(total, batting, pitching))
}

t <- 0
for (i in 9449:dim(rWAR)[1]) {
  t <- t + 1/dim(rWAR)[1]
  print(t)
  rWAR[i,c("rWAR", "rWAR_batting", "rWAR_pitching")] <- get_rWAR(rWAR[i,])
}
rWAR <- rWAR[-9449,]
rWAR$bbrefCode <- str_sub(rWAR$bbrefID, -2, -1) %>% as.numeric()
rWAR <- rWAR[rWAR$bbrefCode != 99,]
for (i in 1:dim(rWAR[is.na(rWAR$rWAR),])[1]) {
  rWAR[is.na(rWAR$rWAR),][i,c("rWAR", "rWAR_batting", "rWAR_pitching")] <- get_rWAR2(rWAR[is.na(rWAR$rWAR),][i,])
}
rWAR <- rWAR %>% select(playerID, bbrefID, rWAR, rWAR_batting, rWAR_pitching)
fwrite(rWAR, "rWAR.csv")
```


Plots 

```{r, include=FALSE}

Master2_plots <- Master2 %>% dplyr::select("playerID", "fangraphsID", "bbrefID", "Name", "fWAR", "rWAR")
Master2_plots <- Master2_plots[complete.cases(Master2_plots),]
plot(x = Master2_plots$rWAR, y = Master2_plots$fWAR, pch = 16, main = "Baseball-Reference vs. FanGraphs WAR", xlab = "Baseball-Reference WAR", ylab = "FanGraphs WAR")
summary(lm(Master2_plots$rWAR ~ Master2_plots$fWAR))
```


Hall of Fame Data

```{r}
HallOfFame2 <- HallOfFame %>% filter(category == "Player")
All_stats <- merge(HallOfFame2[HallOfFame2$inducted == 'Y', c("playerID", "inducted", "votedBy")], rWAR, by = "playerID", all = TRUE)
All_stats[is.na(All_stats$inducted),"inducted"] <- 'N'
All_stats <- left_join(All_stats, Master[,c("playerID", "nameFirst", "nameLast", "finalGame")], by = "playerID")
All_stats <- All_stats %>% filter(finalGame < as.Date("2004-01-01"))
All_stats <- All_stats %>% filter(!(playerID %in% c("brownwi02", "irvinmo01", "paigesa01")))
All_stats$inducted <- ifelse(All_stats$inducted == 'Y', TRUE, FALSE)
fig1 <- ggplot(All_stats, aes(inducted, rWAR, color = votedBy, text = paste(nameFirst, nameLast, sep = " "))) + geom_point() + theme_bw() + labs(title = "rWAR vs. Method of Induction", x = "Induction Status", y = "rWAR")
ggsave("fig1.pdf", fig1)
res1 <- summary(lm(inducted ~ rWAR, All_stats))


HOF_BBWAA <- HallOfFame %>% filter(votedBy == "BBWAA")
HOF_BBWAA$percentVote <- HOF_BBWAA$votes / HOF_BBWAA$ballots
HOF_BBWAA_collapsed <- data.frame()
for (i in unique(HOF_BBWAA$playerID)) {
  temp <- HOF_BBWAA %>% filter(playerID == i)
  res <- c(i, max(temp$yearID), max(temp$yearID) - min(temp$yearID) + 1, ifelse('Y' %in% temp$inducted, 'Y', 'N'), max(temp$percentVote))
  HOF_BBWAA_collapsed <- rbind(HOF_BBWAA_collapsed, res)
}
colnames(HOF_BBWAA_collapsed) <- c("playerID", "finalYear", "totalYears", "BBWAAInducted", "maxPercentVote")

All_stats <- left_join(All_stats, HOF_BBWAA_collapsed, by = "playerID")
All_stats$onBallet <- !is.na(All_stats$BBWAAInducted)
All_stats[is.na(All_stats$maxPercentVote),]$maxPercentVote <- 0
All_stats$maxPercentVote <- All_stats$maxPercentVote %>% as.numeric

fig2 <- ggplot(All_stats, aes(maxPercentVote, rWAR, color = BBWAAInducted)) + geom_point() + theme_bw() + labs(title = "Percent Vote vs. rWAR by BBWAA Results", x = "Maximum Percent Vote", y = "rWAR")
ggsave("fig2.pdf", fig2)
fig3 <- ggplot(All_stats, aes(maxPercentVote, rWAR, color = votedBy, text = paste(nameFirst, nameLast, sep = " "))) + geom_point() + theme_bw() + labs(title = "Percent Vote vs. rWAR by Method of Induction", x = "Maximum Percent Vote", y = "rWAR")
ggsave("fig3.pdf", fig3)
```


Combine Batting/Pitching w/ HOF data

```{r}
All_stats <- left_join(All_stats, batting_career, by = "playerID")
All_stats <- left_join(All_stats, pitching_career, by = "playerID")
pitchers <- All_stats %>% filter(!is.na(G.y)) %>% filter(IPout > 0) %>% filter(GS > 5)
pitchers$ERA <- pitchers$ER / (pitchers$IPout / 27) 
pitchers$inducted <- as.numeric(pitchers$inducted * 1)
mod2 <- lm(inducted ~ W + ERA + SO.y + IPout, pitchers)
summary(mod2)
mod3 <- lm(inducted ~ W + ERA + SO.y, pitchers)
summary(mod3)
pitchers$predictMod2 <- predict(mod2, pitchers)
mod4 <- lm(inducted ~ rWAR_pitching, pitchers)
summary(mod4)
mod5 <- lm(inducted ~ rWAR, pitchers)
summary(mod5)

glm(inducted ~ W + ERA + SO.y + IPout, pitchers, family = "binomial") %>% summary()
```


Compute other statistics

```{r}
# Batting

batting_career$AVG <- batting_career$H.B / batting_career$AB
batting_career$X1B <- batting_career$H.B - batting_career$X2B - batting_career$X3B - batting_career$HR.B
batting_career$SLG <- (batting_career$X1B + 2*batting_career$X2B + 3*batting_career$X3B + 4*batting_career$HR.B) / batting_career$AB
batting_career$PA <- batting_career$AB + batting_career$BB.B + replace_na(batting_career$HBP.B, 0) + replace_na(batting_career$SF.B, 0) + replace_na(batting_career$SH.B, 0) 
batting_career$OBP <- (batting_career$H.B + batting_career$BB.B + replace_na(batting_career$HBP.B, 0)) / (batting_career$PA - replace_na(batting_career$SH.B, 0))
batting_career$OPS <- batting_career$OBP + batting_career$SLG
batting_career$SBP <- batting_career$SB / (batting_career$SB + batting_career$CS)

final_batting <- batting_career %>% dplyr::select(playerID, firstyearID.B, lastyearID.B, AB, H.B, HR.B, AVG, R, RBI, SB, OBP, SLG, OPS)

# Pitching

pitching_career$AB.P <- pitching_career$BFP - pitching_career$BB.P - replace_na(pitching_career$HBP.P, 0) - replace_na(pitching_career$SF.P, 0) - replace_na(pitching_career$SH.P, 0)
pitching_career$BAOpp <- pitching_career$H.P / pitching_career$AB.P
pitching_career$WHIP <- (pitching_career$BB.P + pitching_career$H.P) / (pitching_career$IPout / 3)
pitching_career$IP <- pitching_career$IPout / 3

final_pitching <- pitching_career %>% dplyr::select(playerID, firstyearID.P, lastyearID.P, W, L, ERA, G.P, GS, SV, IP, SO.P, WHIP)
```

```{r Hall of Fame Dataset}
data("HallOfFame")
HallOfFame2 <- data.frame()
HallOfFame <- HallOfFame %>% filter(category == "Player" & ((votedBy == "Veterans" & inducted == 'Y') | votedBy != "Veterans") & votedBy != "Nominating Vote") %>% mutate(percentVote = votes / ballots)
for (i in sort(unique(HallOfFame$playerID))) {
  temp <- HallOfFame %>% filter(playerID == i) 
  bbwaa <- temp %>% filter(votedBy == "BBWAA" | votedBy == "Special Election" | votedBy == "Final Ballot")
  induction <- temp %>% filter(inducted == 'Y')
  lastYear <- temp %>% filter(yearID == max(yearID))
  perVote <- na.omit(temp$percentVote)
  HallOfFame2 <- rbind(HallOfFame2, data.frame(playerID = i, firstYearHOF = min(temp$yearID), lastYearHOF = max(temp$yearID), ballots = dim(bbwaa)[1], inducted = as.logical(dim(induction)[1]), votedBy = ifelse(dim(induction)[1] > 0, induction$votedBy, NA), percentVote = ifelse(length(perVote) == 0, NA, max(perVote))))
}
HallOfFame2$onBallot <- HallOfFame2$ballots > 0
HallOfFame2[HallOfFame2$playerID == "clemero01", "percentVote"] <- 393/420
HallOfFame2[HallOfFame2$playerID == "gehrilo01", "percentVote"] <- NA
fwrite(HallOfFame2, "hof.csv")
```

```{r Combine Stats to one dataframe}
rWAR <- fread("rWAR.csv")
data("Master")
hof <- fread("hof.csv")

Master2 <- left_join(Master, rWAR, by = "playerID") %>% left_join(hof, by = "playerID", all = TRUE)
Master2[is.na(Master2$ballots), "ballots"] <- 0
Master2[is.na(Master2$inducted), "inducted"] <- FALSE
Master2[is.na(Master2$onBallot), "onBallot"] <- FALSE
Master2$banned <- FALSE
Master2[Master2$votedBy == "" & !is.na(Master2$votedBy), "votedBy"] <- NA

banned_players <- c("bechtge01", "devliji01", "hallge01", "nichoal01", "cravebi01", "highadi01", "o'conja01", "howelha01", "fogelho99", "chaseha01", "zimmehe01", "cicoted01", "willile01", "gandich01", "mcmulfr01", "risbesw01", "felscha01", "jacksjo01", "weavebu01", "gedeojo01", "paulege01", "kauffbe01", "mageele01", "douglph01", "o'conji01", "dolanco02", "rosepe01")

Master2[Master2$bbrefID.x %in% banned_players,"banned"] <- TRUE
Master2 <- Master2 %>% mutate(name = paste0(nameFirst, " ", nameLast))
Master2 <- left_join(Master2, final_batting, by = "playerID")
Master2 <- left_join(Master2, final_pitching, by = "playerID")
Master2 <- Master2 %>% dplyr::select(playerID, bbrefID.x, name, debut, finalGame, rWAR, firstyearID.B, lastyearID.B, rWAR_batting, AB, H.B, HR.B, AVG, R, RBI, SB, OBP, SLG, OPS, firstyearID.P, lastyearID.P, rWAR_pitching, W, L, ERA, G.P, GS, SV, IP, SO.P, WHIP, firstYearHOF, lastYearHOF, ballots, onBallot, inducted, votedBy, percentVote, banned)
colnames(Master2) <- c("playerID", "bbrefID", "name", "debut", "finalGame", "rWAR", "firstYearID.B", "lastYearID.B", "rWAR.B", "AB", "H", "HR", "BA", "R", "RBI", "SB", "OBP", "SLG", "OPS", "firstYearID.P", "lastYearID.P", "rWAR.P", "W", "L", "ERA", "G", "GS", "SV", "IP", "SO", "WHIP", "firstYearHOF", "lastYearHOF", "ballots", "onBallot", "inducted", "votedBy", "percentVote", "banned")
Master2[Master2$AB == 0 & !is.na(Master2$AB),c("BA", "OBP", "SLG", "OPS")] <- NA

fwrite(Master2, "baseball.csv")
```


